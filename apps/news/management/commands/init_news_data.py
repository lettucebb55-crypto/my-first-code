from django.core.management.base import BaseCommand
from django.utils import timezone
from datetime import timedelta
from apps.news.models import NewsCategory, News
from apps.users.models import CustomUser


class Command(BaseCommand):
    help = '初始化示例资讯数据'

    def handle(self, *args, **options):
        self.stdout.write('开始创建示例资讯数据...')
        
        # 创建分类
        category1, created = NewsCategory.objects.get_or_create(
            name='旅游攻略'
        )
        category2, created = NewsCategory.objects.get_or_create(
            name='新闻动态'
        )
        category3, created = NewsCategory.objects.get_or_create(
            name='保定文化'
        )
        category4, created = NewsCategory.objects.get_or_create(
            name='出行须知'
        )
        
        # 获取或创建管理员用户作为作者
        admin_user, _ = CustomUser.objects.get_or_create(
            username='admin',
            defaults={
                'email': 'admin@example.com',
                'phone': '13800000000',
                'is_staff': True,
                'is_superuser': True,
            }
        )
        
        # 资讯数据
        news_data = [
            {
                'category': category1,
                'title': '保定三日游超详细攻略（必看）',
                'abstract': '本文为您规划了保定三日游的最佳路线，涵盖了直隶总督署、白洋淀、古莲花池等必游景点，包含详细的行程安排、交通指南、美食推荐和住宿建议。',
                'content': '''# 保定三日游超详细攻略

## 第一天：历史文化之旅

### 上午：直隶总督署
- 开放时间：08:00-18:00
- 门票价格：30元
- 游览时间：2-3小时
- 交通：可乘坐公交1路、2路、4路等到总督署站下车

直隶总督署是中国保存最完整的清代省级衙署，有"一座总督署，半部清史写"的美誉。建议请导游讲解，深入了解清代官署文化。

### 下午：古莲花池
- 开放时间：08:00-18:00
- 门票价格：30元
- 游览时间：1-2小时
- 交通：距离总督署步行约10分钟

古莲花池是中国北方著名的古典园林，夏季荷花盛开时最美。园内亭台楼阁、假山池沼，处处体现古典园林之美。

## 第二天：自然风光之旅

### 全天：白洋淀
- 开放时间：07:00-18:00
- 门票价格：185元（含船票）
- 游览时间：1天
- 交通：从保定市区可乘坐长途客车到安新县，再转乘景区班车

白洋淀是华北地区最大的淡水湖，被誉为"华北明珠"。夏季荷花盛开，可以乘船游览，品尝当地特色美食。

## 第三天：周边景点

### 上午：满城汉墓
- 开放时间：08:00-17:30
- 门票价格：50元
- 游览时间：2-3小时

### 下午：清西陵
- 开放时间：08:00-17:30
- 门票价格：120元
- 游览时间：半天

## 美食推荐
- 保定驴肉火烧
- 白洋淀全鱼宴
- 保定糖葫芦

## 住宿建议
- 市区：推荐住在火车站附近，交通便利
- 白洋淀：可选择景区内民宿，体验水乡风情''',
                'author': admin_user,
                'published_at': timezone.now() - timedelta(days=5),
                'views_count': 1024,
            },
            {
                'category': category2,
                'title': '白洋淀景区国庆期间接待游客超10万人次',
                'abstract': '据报道，国庆黄金周期间，保定市各大景区迎来旅游高峰，其中白洋淀景区接待游客超过10万人次，创历史新高。',
                'content': '''# 白洋淀景区国庆期间接待游客超10万人次

国庆黄金周期间，保定市各大景区迎来旅游高峰。据保定市旅游局统计，白洋淀景区在国庆期间共接待游客超过10万人次，创历史新高。

## 游客增长情况

今年国庆期间，白洋淀景区游客量较去年同期增长30%，主要得益于：
1. 景区基础设施的完善
2. 宣传力度的加大
3. 旅游服务的提升

## 景区应对措施

为应对客流高峰，景区采取了以下措施：
- 增加游船数量
- 延长开放时间
- 增设临时停车场
- 加强安全巡查

## 游客反馈

大部分游客对景区服务表示满意，特别是：
- 游船服务规范
- 环境卫生良好
- 安全措施到位

## 未来规划

景区计划进一步完善基础设施，提升服务质量，为游客提供更好的旅游体验。''',
                'author': admin_user,
                'published_at': timezone.now() - timedelta(days=33),
                'views_count': 512,
            },
            {
                'category': category3,
                'title': '保定历史文化名城：千年古城的魅力',
                'abstract': '保定作为历史文化名城，拥有深厚的历史底蕴和丰富的文化遗产。本文带您了解保定的历史文化特色。',
                'content': '''# 保定历史文化名城：千年古城的魅力

保定，位于河北省中部，是一座拥有3000多年历史的文化名城。作为河北省的历史文化名城，保定拥有丰富的历史文化遗产。

## 历史沿革

保定历史悠久，早在春秋战国时期就有建城记录。明清时期，保定是直隶省省会，直隶总督署就设在这里。

## 文化遗产

### 直隶总督署
中国保存最完整的清代省级衙署，见证了清代200多年的历史。

### 古莲花池
中国北方著名的古典园林，体现了中国传统园林艺术的精髓。

### 满城汉墓
出土了著名的"金缕玉衣"，是研究汉代文化的重要遗址。

## 文化特色

保定文化融合了燕赵文化和京畿文化，形成了独特的文化特色。保定还是中国著名的"武术之乡"和"戏曲之乡"。

## 现代发展

在保护历史文化的同时，保定也在积极发展现代旅游业，让更多人了解保定的历史文化魅力。''',
                'author': admin_user,
                'published_at': timezone.now() - timedelta(days=20),
                'views_count': 856,
            },
            {
                'category': category1,
                'title': '白洋淀最佳旅游时间及游玩攻略',
                'abstract': '白洋淀什么时候去最好？本文为您详细介绍白洋淀的最佳旅游时间、游玩路线和注意事项。',
                'content': '''# 白洋淀最佳旅游时间及游玩攻略

## 最佳旅游时间

白洋淀的最佳旅游时间是**6-9月**，此时：
- 荷花盛开，景色最美
- 天气适宜，适合乘船游览
- 可以品尝到新鲜的莲子和莲藕

## 游玩路线推荐

### 一日游路线
1. 上午：乘船游览荷花淀
2. 中午：品尝白洋淀全鱼宴
3. 下午：参观文化苑，了解水乡文化

### 两日游路线
第一天：游览主要景点
第二天：深度体验水乡生活

## 注意事项

1. **防晒**：夏季阳光强烈，建议携带防晒用品
2. **防蚊**：水边蚊虫较多，建议携带驱蚊用品
3. **安全**：乘船时注意安全，听从导游安排
4. **环保**：不要乱扔垃圾，保护环境

## 交通指南

从保定市区：
- 可乘坐长途客车到安新县
- 再转乘景区班车到白洋淀

## 住宿建议

可选择景区内民宿，体验水乡风情，也可以返回保定市区住宿。''',
                'author': admin_user,
                'published_at': timezone.now() - timedelta(days=12),
                'views_count': 723,
            },
            {
                'category': category4,
                'title': '保定旅游出行须知：这些事项要注意',
                'abstract': '来保定旅游需要注意什么？本文为您整理了保定旅游的出行须知，包括交通、住宿、饮食等方面的注意事项。',
                'content': '''# 保定旅游出行须知：这些事项要注意

## 交通出行

### 到达保定
- **火车**：保定有多个火车站，交通便利
- **汽车**：保定汽车站有发往各地的班车
- **自驾**：保定高速公路发达，自驾方便

### 市内交通
- 公交：保定公交系统完善，票价1-2元
- 出租车：起步价6元，方便快捷
- 共享单车：市区有共享单车，适合短途出行

## 住宿建议

### 市区住宿
- 推荐住在火车站附近，交通便利
- 或选择市中心区域，购物方便

### 景区住宿
- 白洋淀、野三坡等景区有民宿和酒店
- 建议提前预订，特别是节假日

## 饮食注意

1. **保定特色**：驴肉火烧、糖葫芦等
2. **饮食卫生**：选择正规餐厅
3. **饮食习惯**：保定菜偏咸，注意适应

## 天气准备

- **春季**：早晚温差大，注意保暖
- **夏季**：炎热多雨，注意防晒防雨
- **秋季**：天气凉爽，适合旅游
- **冬季**：寒冷干燥，注意保暖

## 安全提示

1. 保管好个人财物
2. 遵守景区规定
3. 注意交通安全
4. 遇到问题及时求助

## 其他建议

- 携带身份证等有效证件
- 准备常用药品
- 了解当地风俗习惯
- 保持环保意识''',
                'author': admin_user,
                'published_at': timezone.now() - timedelta(days=8),
                'views_count': 645,
            },
            {
                'category': category2,
                'title': '野三坡景区推出新项目：玻璃栈道正式开放',
                'abstract': '野三坡景区新建的玻璃栈道正式对外开放，为游客提供了全新的观景体验，吸引了大量游客前来体验。',
                'content': '''# 野三坡景区推出新项目：玻璃栈道正式开放

野三坡景区新建的玻璃栈道于近日正式对外开放，为游客提供了全新的观景体验。

## 项目介绍

玻璃栈道全长300米，位于百里峡景区内，距离地面高度约100米。栈道采用高强度钢化玻璃建造，安全可靠。

## 游客体验

开放首日，就有大量游客前来体验。游客纷纷表示：
- 视野开阔，景色壮观
- 刺激有趣，值得体验
- 安全措施到位，放心游玩

## 开放时间

- 开放时间：07:00-18:00
- 门票价格：需单独购票，30元/人
- 注意事项：恐高症患者谨慎体验

## 未来规划

景区计划继续完善配套设施，为游客提供更好的服务体验。''',
                'author': admin_user,
                'published_at': timezone.now() - timedelta(days=3),
                'views_count': 389,
            },
        ]
        
        # 创建资讯
        created_count = 0
        for news_item in news_data:
            news, created = News.objects.get_or_create(
                title=news_item['title'],
                defaults=news_item
            )
            if created:
                created_count += 1
                self.stdout.write(self.style.SUCCESS(f'[OK] 创建资讯: {news.title}'))
            else:
                self.stdout.write(self.style.WARNING(f'[SKIP] 资讯已存在: {news.title}'))
        
        self.stdout.write(self.style.SUCCESS(f'\n成功创建 {created_count} 条资讯！'))

